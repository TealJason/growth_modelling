<!DOCTYPE html>
<html>
<head>
    <title>Bacterial Growth Modeller</title>
    <style>
        /* Center the form */
        form {
            width: 1000px;
            margin: auto;
            align-self: center;
        }
        html, body {
            height: 100%;
            margin: 0;
            background-color: #10B2A2;
        }

    </style>

</head>
<body>

<h1>
    <form id="growthform" method="POST" action="{% url 'index' %}">
        {% csrf_token %}
        <label for="i_density">Initial Density:</label>
        <input type="range" id="i_density" name="i_density"  min="1" max="100" step="1"value="15">
        <span id="i_density_val">15</span><br><br>
        
        <label for="p_density">Plateau Density:</label>
        <input type="range" id="p_density" name="p_density" min="1" max="5000" value="2500">
        <span id="p_density_val">2500</span><br><br>
        
        <label for="g_rate">Growth Rate:</label>
        <input type="range" id="g_rate" name="g_rate" min="0.1" max="1" step="0.05" value="0.15">
        <span id="g_rate_val">0.15</span><br><br>

        <label for="temperature">Temperature:</label>
        <input type="range" id="temperature" name="temperature" min="-20" max="100" step="1" value="37">
        <span id="temperature_val">37</span><br><br>

        <label for="time_steps">Time Steps:</label>
        <input type="range" id="time_steps" name="time_steps" min="30" max="10000" step="1" value="45">
        <span id="time_steps_val">45</span><br><br>

        <label for="Species to model"></label>
        <input type="radio" id="species" name="species" value="E.coli" checked>
        <span>Model E.coli growth</span><br><br>        

        <label for="Species to model"></label>
        <input type="radio" id="species" name="species" value="S.aureus" >
        <span>Model S.aureus growth</span><br><br>        

        <label for="Species to model"></label>
        <input type="radio" id="species" name="species" value="L.monocytogenes" >
        <span>Model L.monocytogenes growth</span><br><br>        

        <label for="Species to model"></label>
        <input type="radio" id="species" name="species" value="P.aeruginosa" >
        <span>Model P.aeruginosa growth</span><br><br>        

        <label for="Species to model"></label>
        <input type="radio" id="species" name="species" value="B.subtilis" >
        <span>Model B.subtilis growth</span><br><br>        

        <input type="submit" value="Submit">
    </form>
</h1>
    <script>
        // Link sliders to their display spans
        const sliders = [
            {id: "i_density", display: "i_density_val"},
            {id: "p_density", display: "p_density_val"},
            {id: "g_rate", display: "g_rate_val"},
            {id: "temperature", display: "temperature_val"},
            {id: "time_steps", display: "time_steps_val"},
        ];
    
        sliders.forEach(s => {
            const slider = document.getElementById(s.id);
            const display = document.getElementById(s.display);
            slider.addEventListener("input", () => {
                display.textContent = slider.value;
            });
        });
    </script>

<h2>
<div id="result_div" style="display: flex; gap: 20px; justify-content: center;"> 
    <!-- Results will be injected here -->
</div>
</h2>

<script>
    const form = document.getElementById("growthform"); // the form element we monitor for the posts 

    form.addEventListener("submit", function(e) {
        e.preventDefault(); // stop full page reload

        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
                "X-Requested-With": "XMLHttpRequest" // mark as AJAX
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById("result_div").innerHTML = html; // where we injec the resutls
        })
        .catch(err => console.error("Error fetching result:", err));
    });
</script>
    
</body>
</html>